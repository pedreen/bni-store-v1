services:
  magento:
    image: docker.pentagrama.net.br/bni/magento:1.2.3
    container_name: magento
    entrypoint:
      - /bin/sh
      - -c
      - /usr/local/bin/entrypoint.sh
    command:
      - /usr/bin/supervisord
    working_dir: /var/www/html
    env_file: .env
    volumes:
      - ./media:/var/www/html/media
      - ./app:/var/www/html
      - ./reports:/var/www/html/var/report
      - ./logs:/var/www/html/var/log
      - ./config/local.xml:/var/www/html/app/etc/local.xml
    restart: "unless-stopped"
    logging:
      driver: "json-file"
      options:
        max-size: "10M"
        max-file: "5"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - "8789:80"
  redis:
    image: valkey/valkey:8.0.3-alpine3.21
    container_name: magento-redis
    environment:
      - ALLOW_EMPTY_PASSWORD=yes
    restart: unless-stopped
    logging:
      driver: "json-file"
      options:
        max-size: "10M"
        max-file: "5"

networks:
  internal:
